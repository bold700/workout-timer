<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonos Verbinden - Workout Timer</title>
    <script>
      (function() {
        var l = window.location;
        var params = l.search;
        var code = new URLSearchParams(params).get('code');
        var state = new URLSearchParams(params).get('state');
        var error = new URLSearchParams(params).get('error');
        
        // Check of we in een Capacitor app zijn
        var isCapacitor = false;
        if (typeof window.Capacitor !== 'undefined' || 
            window.navigator.userAgent.indexOf('Capacitor') !== -1 ||
            window.navigator.userAgent.indexOf('Workout Timer') !== -1) {
          isCapacitor = true;
        }
        
        console.log('Callback page - isCapacitor:', isCapacitor, 'params:', params);
        
        if (isCapacitor) {
          // In de app: sla parameters op in localStorage en redirect naar root
          if (code || error) {
            // Sla callback data op
            if (code) {
              localStorage.setItem('sonos_callback_code', code);
            }
            if (state) {
              localStorage.setItem('sonos_callback_state', state);
            }
            if (error) {
              localStorage.setItem('sonos_callback_error', error);
            }
            localStorage.setItem('sonos_callback_timestamp', Date.now().toString());
            
            // Redirect naar root (app base path)
            l.replace('/');
          } else {
            // Geen parameters, gewoon naar root
            l.replace('/');
          }
        } else {
          // Web versie: redirect naar web app met params
          var basePath = '/workout-timer/';
          l.replace(
            l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') +
            basePath +
            params +
            (l.hash || '')
          );
        }
      })();
    </script>
  </head>
  <body>
    <p>Verbinden met Sonos...</p>
  </body>
</html>
